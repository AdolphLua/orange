# Line below determines the directory with Python.h.
# If this does not work, find Python.h yourself and enter
# the directory below.
PYTHONINCLUDE = $(shell python -c "import sys; print sys.prefix+'/include/python'+sys.version[:3]")
PYTHONLIB = $(shell python -c "import sys; print sys.prefix+'/lib/python'+sys.version[:3]")
PYTHONSITEPKGS = $(PYTHONLIB)/site-packages


DESTDIR = $(PYTHONSITEPKGS)/orange
DOCDIR = /usr/local/doc/orange
SCRIPTDIR = /usr/local/bin
INSTALL = install
INSTALL_DATA = $(INSTALL) -m 644
INSTALL_SCRIPT = $(INSTALL)
INSTALL_SHARED = $(INSTALL) -m 555
INSTALL_DIR = $(INSTALL) -d -m 755

OS = $(shell uname)
MAKE = make
COMPILER = g++
CCOMPILER = gcc
LINKER = gcc
LIBRARY_FILE = liborange.so

# Paths to Mac bundle header and framework files
BUNDLE_INCLUDE = $(OLD)/../orange-temp/Orange.app/Contents/Resources/include/
BUNDLE_FRAMEWORK = $(OLD)/../orange-temp/Orange.app/Contents/Frameworks/

ifeq ($(OS), Darwin)
  COMPILEOPTIONS = -arch i386 -arch ppc -fPIC -fpermissive -fno-common -w -DDARWIN -D$(MODULENAME)_EXPORTS -D_POSIX_C_SOURCE -O3 -I$(BUNDLE_INCLUDE)
  LINKOPTIONS = -arch i386 -arch ppc -dynamiclib -F$(BUNDLE_FRAMEWORK) -framework Python -lstdc++ -L$(OLD) -lorange_include
  LINKER = g++
  LIBRARY_FILE = liborange.dylib
else
ifeq ($(OS), FreeBSD)
  COMPILEOPTIONS = -fPIC -fpermissive -w -DFREEBSD -O3
  LINKOPTIONS = -shared -lstdc++ -L$(OLD) -lorange_include
  LINKOPTIONS += `gsl-config --libs`
  MAKE = gmake
else
  COMPILEOPTIONS = -fPIC -fpermissive -w -DLINUX -D$(MODULENAME)_EXPORTS -O3
  LINKOPTIONS = -shared -lstdc++ -L$(OLD) -lorange_include
endif
endif

ifneq ($(MODULENAME), ORANGE)
  LINKOPTIONS += -lorange
endif

vpath %.cpp ../include
vpath %.hpp ../include
vpath %.px px
vpath %.ppp ppp
vpath %.h orange:include:$(PYTHONINCLUDE):/usr/local/include/gsl:/usr/include/gsl

obj/%.o : %.cpp
	$(COMPILER) $(COMPILEOPTIONS) -c $< -o $@


export CPATH=ppp:px:../include:../orange:$(PYTHONINCLUDE):/usr/local/include:/usr/include:$(PYTHONSITEPKGS)/numpy/core/include

makefile.deps:
	python ../pyxtract/makedep.py -n $(MODULENAME)
	rm -f ppp/stamp
	rm -f px/stamp

objdir:
	-@mkdir -p obj > /dev/null

cleantemp:
	rm -rf obj ppp px makefile.deps
